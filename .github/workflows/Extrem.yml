name: macOS GUI Stable
on: workflow_dispatch

jobs:
  gui-access:
    runs-on: macos-latest
    steps:
      - name: Install Bore
        run: brew install bore-cli

      - name: Setup Display and Remote Management
        run: |
          # Aktifkan Remote Management dan VNC Password
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -privs -all -restart -agent
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -configure -clientopts -setvnclegacy -vnclegacy yes -setvncpw -vncpw Password123
          
          # Pengaturan agar layar tidak tidur dan GUI tetap aktif
          sudo systemsetup -setdisplaysleep off > /dev/null 2>&1
          sudo systemsetup -setsleep off > /dev/null 2>&1
          sudo caffeinate -is &

      - name: Start Tunnel
        run: |
          # Jalankan tunnel untuk port 5900 (VNC)
          bore local 5900 --to bore.pub &
          sleep 5

      - name: Force Wake UI
        run: |
          # Memaksa WindowServer untuk me-render tampilan desktop
          sudo launchctl kickstart -kp system/com.apple.WindowServer
          
          echo "================================================"
          echo "Akses VNC Anda sudah siap"
          echo "Host: bore.pub"
          echo "Port: (Cek di log Start Tunnel)"
          echo "VNC Password: Password123"
          echo "================================================"
          
          # Menjaga runner tetap aktif selama 6 jam
          sleep 21600
