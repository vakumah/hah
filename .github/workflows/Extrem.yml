name: macOS GUI with Bore
on: workflow_dispatch

jobs:
  gui-access:
    runs-on: macos-latest
    steps:
      - name: Install Bore
        run: |
          brew install bore-cli

      - name: Aktifkan Screen Sharing (VNC)
        run: |
          # Set password untuk user 'runner'
          sudo dscl . -passwd /Users/runner Password123
          
          # Aktifkan Remote Management / Screen Sharing
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -restart -agent -privs -all

      - name: Jalankan Bore Tunnel
        run: |
          # Bore akan mem-forward port 5900 (VNC) ke server publik bore.pub
          # Perintah ini dijalankan di background (&) agar langkah selanjutnya tetap jalan
          bore local 5900 --to bore.pub & 
          sleep 5
          
      - name: Informasi Koneksi
        run: |
          echo "================================================"
          echo "Akses VNC Anda sedang disiapkan..."
          echo "Gunakan VNC Viewer dengan detail berikut:"
          echo "Host: bore.pub"
          echo "Port: (Lihat di log Bore di atas)"
          echo "Username: runner"
          echo "Password: Password123"
          echo "================================================"
          # Menjaga agar session tetap hidup selama 6 jam
          sleep 21600
