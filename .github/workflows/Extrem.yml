name: macOS GUI Force Runner
on: workflow_dispatch

jobs:
  gui-access:
    runs-on: macos-latest
    steps:
      - name: Install Bore
        run: brew install bore-cli

      - name: Force Reset Password Runner
        run: |
          # Memaksa reset password user 'runner' tanpa minta password lama
          sudo sysadminctl -adminUser runner -adminPassword "" -resetPasswordFor runner -newPassword "Password123"
          
      - name: Aktifkan Screen Sharing (VNC)
        run: |
          # Aktifkan Remote Management
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -restart -agent -privs -all -allowAccessForAllUsers

      - name: Jalankan Bore Tunnel
        run: |
          # Forward port 5900 (VNC) ke server publik
          bore local 5900 --to bore.pub & 
          sleep 5
          
      - name: Informasi Koneksi
        run: |
          echo "================================================"
          echo "Cek log 'Jalankan Bore Tunnel' untuk melihat PORT"
          echo "Host: bore.pub"
          echo "Username: runner"
          echo "Password: Password123"
          echo "================================================"
          # Menjaga runner aktif 6 jam
          sleep 21600
