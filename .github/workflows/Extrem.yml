name: macOS GUI
on: workflow_dispatch

jobs:
  gui-access:
    runs-on: macos-latest
    steps:
      - name: Install Bore
        run: brew install bore-cli

      - name: Configure User
        run: |
          sudo dscl . -passwd /Users/runner "" "Password123" || true
          sudo osascript -e 'tell application "System Events" to set password of user "runner" to "Password123"' || true

      - name: Enable Remote Management
        run: |
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart -activate -configure -access -on -restart -agent -privs -all -allowAccessForAllUsers

      - name: Start Tunnel
        run: |
          bore local 5900 --to bore.pub & 
          sleep 5
          
      - name: Connection Info
        run: |
          echo "Host: bore.pub"
          echo "User: runner"
          echo "Pass: Password123"
          sleep 21600
