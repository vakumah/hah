name: macOS-GUI-LocalTunnel

on:
  workflow_dispatch:

jobs:
  macos-gui:
    runs-on: macos-latest

    steps:
      - name: Enable Screen Sharing (VNC)
        run: |
          sudo launchctl load -w /System/Library/LaunchDaemons/com.apple.screensharing.plist
          sudo defaults write /Library/Preferences/com.apple.VNCSettings ControlDial -bool true
          sudo /System/Library/CoreServices/RemoteManagement/ARDAgent.app/Contents/Resources/kickstart \
            -activate -configure -access -on \
            -clientopts -setvnclegacy -vnclegacy yes \
            -clientopts -setvncpw -vncpw "123456" \
            -restart -agent -privs -all
          echo "VNC Password set to: 123456"

      - name: Install Node & LocalTunnel
        run: |
          brew install node
          npm install -g localtunnel

      - name: Start LocalTunnel for port 5900
        run: |
          echo "Starting LocalTunnel on port 5900..."
          lt --port 5900 > lturl.log &

          sleep 5
          echo "===== LOCAL TUNNEL URL ====="
          cat lturl.log

      - name: Keep Runner Alive (12 hours)
        run: |
          echo "Runner active for 12 hours..."
          sleep 43200
